<declare-config>

	<systems>
		<system name="user">
			<datas>
				<data name="userData">
					<depends>
						<depend data="$userData" init="status:1"/>
					</depends>
				</data>
			</datas>
		</system>
		<system name="order">
			<datas>

				<data name="subscribeOrderData" desc="订购订单数据" isCachePrior="false">
					<depends>
						<depend data="$subscribeOrderData" init="status:1"/>
					</depends>
				</data>

				<data name="orderData" desc="订单数据" type="persistent" isCachePrior="false">
				</data>

				<data name="orderPayResultData" desc="订单支付状态数据"  type="persistent" isCachePrior="false">
					<depends>
						<depend data="$payResultData"/>
						<depend data="orderData" condition="status=1"/>
					</depends>
				</data>
			</datas>
		</system>

		<system name="pay" desc="支付">
			<datas>
				<data name="payCmdData" desc="支付指令数据">
					<depends>
						<depend data="$payData"/>
					</depends>
				</data>

				<data name="payResultData" desc="支付结果数据"  type="persistent" isCachePrior="true">
					<depends>
						<depend data="payCmdData"/>
					</depends>
				</data>
			</datas>
		</system>

		<system name="common">
			<datas>
				<data name="$userData" desc="用户数据"/>
				<data name="$cancelOrderData" desc="取消订购操作数据"/>
				<data name="$subscribeOrderData" desc="订购数据"/>
				<data name="$payData" desc="支付数据"/>
				<data name="$payResultData" desc="支付数据"/>
				<data name="$refundOrderData" desc="订单退款数据"/>
			</datas>
		</system>
	</systems>



	<businesses>

		<business name="saveUser" ref-dom="save-User:con1">
			<datas>
				<data begin="true" ref-rule-connection="con1"/>
					<data system="user" name="userData"  system-to-dom="this:this"/>
					<data ref-rule="save-User" ref-rule-range="insertUser"/>
				<data end="true"/>
			</datas>
		</business>

		<business name="subscribeOrderWithDom" ref-dom="save-Order:con1">
			<datas>
				<data begin="true" ref-rule-connection="con1"/>
					<data system="order" name="subscribeOrderData" ref-rule="save-Order" ref-rule-replace="insertOrder" system-to-dom="this:this,orderDetailList:orderDetailList"/>
						<data begin="true" transactionPolicy="NEW" ref-rule-connection="con1"/>
							<data ref-rule="save-Order" ref-rule-range="insertOrderDetail"/>
							<data begin="true" transactionPolicy="NEW" ref-rule-connection="con1"/>
								<data system="pay" name="payResultData" system-to-dom="this:payInfo,payDetailList:payInfo.payDetailList"/>
								<!--<data ref-rule="save-Order" ref-rule-range="insertPayInfo:insertPayDetailList" dom-to-system="this:payInfo,payDetailList:payInfo.payDetailList"/>-->
								<data ref-rule="save-Order" ref-rule-range="insertPayInfo:insertPayDetailList" system="pay" name="payResultData" dom-to-system="payInfo.payDetailList:payDetailList" />
								<data name="$payResultData" />
							<data end="true"/>
						<data end="true"/>
					<!--<data system="order" name="orderPayResultData"/>-->
				<data end="true"/>
			</datas>
		</business>
	</businesses>
</declare-config>